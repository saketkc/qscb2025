---
title: "Day 02A - Liver spatial transcriptomics analysis"
author: "Saket Choudhary <saketc@iitb.ac.in> for QSCB 2025"
date: today
format:
  html:
    embed-resources: true
    toc: false
    number-sections: true
    code-fold: show
    code-tools: true
    code-copy: true
    theme: cosmo
    css: styles.css
    fig-width: 8
    fig-height: 6
    df-print: paged
editor: visual
---

# Dataset

Take from http://livercellatlas.org/ human single-nuclei and spatial datasets

# Look at spatial data

```{r}
suppressPackageStartupMessages({
  library(tidyverse)
  library(Seurat)
})

object.names <- c("H35_1", "H35_2", "H36", "H37", "H38")

spatial.rna.objects <- list()
for (object.name in object.names) {
  object <- readRDS(paste0("/NAS/qscb2025/Guilliams_2022_livercellatlas/data/liver/spatial/", object.name, ".rds"))
  object2 <- CreateSeuratObject(
    counts = LayerData(object, assay = "Spatial", layer = "counts"),
    meta.data = object@meta.data
  )
  object2 <- NormalizeData(object2)
  spatial.rna.objects[[object.name]] <- object2
}
```

```{}
```

```{r}
spatial.rna.merged <- merge(spatial.rna.objects[[1]], spatial.rna.objects[2:length(spatial.rna.objects)])
spatial.rna.merged <- SCTransform(spatial.rna.merged, verbose = FALSE)
spatial.rna.merged <- RunPCA(spatial.rna.merged, verbose = FALSE)
spatial.rna.merged <- FindNeighbors(spatial.rna.merged, dims = 1:30, verbose = FALSE)
spatial.rna.merged <- RunUMAP(spatial.rna.merged, dims = 1:30, verbose = FALSE)

```

# Exercise 1: Does this require integration?

If so show implement it

```{r}
#| fig-width: 8
#| fig-height: 6

DimPlot(spatial.rna.merged, group.by = "sample_name")
# YOUR CODE HERE
```

# Exercise 2: Does this require integration?

If so show implement it

```{r}
rna.merged <- readRDS("/NAS/qscb2025/Guilliams_2022_livercellatlas/data/liver/rna/GSE192740_rna.rds")

# check metadata
head(rna.merged)

# Perform steps
# YOUR CODE HERE
```

```{r}
#| fig-width: 8
#| fig-height: 6

DimPlot(rna.merged, group.by = "sample")
# YOUR CODE HERE
```

# Exercise 3: Subset H37 patient and predict the celltypes in H38 patient

```{r}
# YOUR CODE HERE
```

# Exercise 4: You were given the objects pre-processed (to some extent)

Go to http://livercellatlas.org/ or search GSE192740 to download the raw counts file and metadata and create the seurat objects

# Exercise 5: Integrate the mouse and the human datasets
